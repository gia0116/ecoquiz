<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ìƒíƒœÂ·í™˜ê²½ í€´ì¦ˆ â€” ë±€íŒŒì´ì–´ ìŠ¤íƒ€ì¼</title>
<style>
  :root{
    --bg1: #0b0b0b;
    --bg2: #11060a;
    --accent: #b9142f; /* crimson */
    --muted: #9a8f95;
    --glass: rgba(255,255,255,0.04);
    --card: rgba(255,255,255,0.03);
    --glow: 0 8px 30px rgba(185,20,47,0.25);
  }
  *{box-sizing:border-box;margin:0;padding:0}
  html,body,#app{height:100%}
  body{
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
    background: radial-gradient(circle at 20% 10%, rgba(185,20,47,0.06) 0%, transparent 12%),
                linear-gradient(180deg, var(--bg1), var(--bg2) 60%);
    color:#eee;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    overflow:hidden;
  }

  /* atmospheric decorative moon & bats */
  .sky{
    position:fixed; inset:0; pointer-events:none;
    background:
      radial-gradient(circle at 85% 15%, rgba(255,255,255,0.04) 0%, transparent 6%),
      radial-gradient(circle at 80% 18%, rgba(200,200,255,0.03) 0%, transparent 10%);
    mix-blend-mode: overlay;
  }
  .moon{
    position: absolute;
    right:4%;
    top:6%;
    width:140px;
    height:140px;
    border-radius:50%;
    background: linear-gradient(145deg,#fff2 #ddd8);
    opacity:0.08;
    filter:blur(2px);
    box-shadow: 0 0 40px rgba(185,20,47,0.06), inset -8px -6px 20px rgba(0,0,0,0.25);
    transform: rotate(-12deg);
  }
  .bats{
    position:absolute; left:6%; top:12%; width:300px; height:120px; opacity:0.12;
    background-image: radial-gradient(closest-side, transparent 60%, rgba(0,0,0,0.0)), url('data:image/svg+xml;utf8,\
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 80">\
        <path d=\"M10 40c20-20 40-20 60 0 20-20 40-20 60 0 0 0-10-6-20-6-10 0-20 8-30 8s-20-8-30-8c-10 0-20 6-20 6z\" fill=\"black\"/>\
      </svg>'); background-size:contain;background-repeat:no-repeat;
    transform:rotate(-8deg);
    animation: bats 12s linear infinite;
  }
  @keyframes bats{ 0%{transform:translateX(-30px) rotate(-6deg)} 50%{transform:translateX(30px) rotate(6deg)} 100%{transform:translateX(-30px) rotate(-6deg)} }

  /* container */
  #app{
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    height:100vh; width:100vw; position:relative;
  }

  /* header */
  header{
    position:absolute; top:18px; left:18px; right:18px; display:flex; align-items:center; justify-content:space-between;
    pointer-events:auto;
  }
  .brand{
    display:flex; gap:12px; align-items:center;
    background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.015));
    padding:8px 12px; border-radius:12px; backdrop-filter: blur(6px);
    box-shadow: var(--glow);
  }
  .logo{
    width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,#1b0004,#3a0b12);
    display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--accent);
    font-size:20px; box-shadow:0 6px 20px rgba(0,0,0,0.6) inset;
  }
  .title{font-weight:700; font-size:14px; color:#ffdfe6}
  .subtitle{font-size:11px;color:var(--muted)}

  .status{
    display:flex; gap:12px; align-items:center;
    background:var(--glass); padding:8px 12px; border-radius:12px;
  }
  .pill{padding:6px 10px;border-radius:999px;background:transparent;color:var(--muted);font-size:13px;border:1px solid rgba(255,255,255,0.03)}

  /* main pages container */
  .pages{
    width:100vw; height:100vh; display:flex; flex-direction:row; transition:transform .6s cubic-bezier(.2,.9,.2,1);
    will-change:transform;
  }

  .page{
    width:100vw; height:100vh; padding:48px; flex:0 0 100vw; display:flex; align-items:center; justify-content:center;
    position:relative;
  }

  /* card */
  .card{
    width:86%; max-width:1100px; min-width:320px; height:78vh; border-radius:18px; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    box-shadow: 0 20px 50px rgba(0,0,0,0.6), var(--glow);
    padding:36px; display:flex; flex-direction:column; gap:18px; position:relative;
    border:1px solid rgba(185,20,47,0.06); overflow:hidden;
  }

  .card:before{
    content:""; position:absolute; inset:0; background:radial-gradient(circle at 30% 10%, rgba(185,20,47,0.02), transparent 15%); pointer-events:none;
  }

  .qmeta{display:flex; justify-content:space-between; align-items:center; gap:12px}
  .qnum{font-size:18px; font-weight:700; color:#ffdfe6}
  .diff{font-size:12px; color:var(--muted); padding:6px 10px; border-radius:999px; background:rgba(255,255,255,0.02)}

  .question{
    font-size:28px; line-height:1.2; font-weight:700; letter-spacing:-0.5px; margin-top:6px;
    text-shadow: 0 2px 0 rgba(0,0,0,0.6);
  }
  .hint{font-size:13px;color:var(--muted); margin-top:4px}

  .options{
    display:grid; grid-template-columns:1fr 1fr; gap:14px; margin-top:18px; flex:1 1 auto;
  }
  .option{
    background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
    border-radius:12px; padding:16px; display:flex; align-items:flex-start; gap:12px; cursor:pointer;
    border:1px solid rgba(255,255,255,0.02); transition:transform .14s ease, box-shadow .14s ease;
    user-select:none;
  }
  .option:hover{ transform:translateY(-6px); box-shadow:0 18px 40px rgba(0,0,0,0.6)}
  .option .label{width:36px;height:36px;border-radius:8px;background:linear-gradient(135deg,#2a0a12,#0c0204);display:flex;align-items:center;justify-content:center;font-weight:800;color:var(--accent);font-size:16px}
  .option .text{font-size:15px; color:#efe8ea}

  .option.correct { border:1px solid rgba(20,200,120,0.12); box-shadow:0 10px 30px rgba(20,200,120,0.04);}
  .option.wrong { opacity:0.6; filter:grayscale(0.25); border:1px solid rgba(200,20,20,0.08) }

  /* footer controls */
  .controls{display:flex; gap:12px; align-items:center; justify-content:space-between; margin-top:18px}
  .left-controls{display:flex; gap:10px; align-items:center}
  .btn{
    background:transparent; border-radius:10px; padding:10px 14px; border:1px solid rgba(255,255,255,0.04);
    color:var(--muted); cursor:pointer; font-weight:700;
  }
  .btn.primary{background:linear-gradient(90deg,var(--accent),#7b0b2a); color:#fff; box-shadow:var(--glow); border:0}
  .progress{
    height:12px; width:300px; background:rgba(255,255,255,0.02); border-radius:999px; overflow:hidden;
  }
  .progress > i{display:block;height:100%; background:linear-gradient(90deg,var(--accent), #7b0b2a); width:0%}

  .big-score{
    position:absolute; right:36px; bottom:36px; background:rgba(0,0,0,0.45); padding:18px;border-radius:14px;border:1px solid rgba(255,255,255,0.02);
    font-size:20px; font-weight:800; color:#ffdfe6;
  }

  /* final screen */
  .final{
    display:flex; flex-direction:column; align-items:center; justify-content:center; height:100%;
    gap:18px; text-align:center;
  }
  .final .result{ font-size:44px; font-weight:900; color:var(--accent); text-shadow:0 6px 30px rgba(185,20,47,0.15) }
  .final .detail{color:var(--muted); max-width:760px}

  /* responsive */
  @media (max-width:880px){
    .options{ grid-template-columns:1fr; }
    .card{ height:84vh; padding:20px }
    .question{ font-size:22px }
    .title{ font-size:13px }
  }

  /* keyboard hint */
  .kbd-hint{ position:absolute; left:18px; bottom:18px; color:var(--muted); font-size:13px }
</style>
</head>
<body>
<div class="sky" aria-hidden="true">
  <div class="moon"></div>
  <div class="bats"></div>
</div>

<div id="app" role="application" aria-label="ìƒíƒœ í™˜ê²½ í€´ì¦ˆ">
  <header>
    <div class="brand" aria-hidden="false">
      <div class="logo">ğŸ¦‡</div>
      <div>
        <div class="title">Nocturne Ecology Quiz</div>
        <div class="subtitle">ìƒíƒœÂ·í™˜ê²½ â€” ë±€íŒŒì´ì–´ ê°ì„±</div>
      </div>
    </div>
    <div class="status" aria-hidden="false">
      <div class="pill" id="qcount">ë¬¸ì œ 1 / 10</div>
      <div class="pill" id="difficulty">ë‚œì´ë„: ë³´í†µ</div>
    </div>
  </header>

  <div class="pages" id="pages" tabindex="0">
    <!-- pages generated by JS -->
  </div>

  <div class="big-score" id="bigScore" aria-live="polite">ì ìˆ˜: 0</div>
  <div class="kbd-hint">í‚¤: â†/â†’ ì´ë™ Â· 1-4 ì„ íƒ Â· Enter ë‹¤ìŒ</div>
</div>

<script>
/* QUIZ DATA (Korean). 10 questions; two marked hard. */
const quiz = [
  {
    q: "ìƒíƒœê³„ì—ì„œ 'ìƒì‚°ì'ì— í•´ë‹¹í•˜ëŠ” ìƒë¬¼êµ°ì€ ë¬´ì—‡ì¸ê°€ìš”?",
    opts: ["ìœ¡ì‹ì„± í¬ì‹ì", "ì´ˆì‹ ë™ë¬¼", "ê´‘í•©ì„±ì„ í•˜ëŠ” ì‹ë¬¼ ë° ì¡°ë¥˜", "ë¶„í•´ì (ì„¸ê· Â·ê· ë¥˜)"],
    a: 2,
    diff: "ë³´í†µ",
    hint: "ìƒì‚°ìëŠ” ê´‘í•©ì„±ì„ í†µí•´ ìœ ê¸°ë¬¼ì„ ìƒì‚°í•©ë‹ˆë‹¤."
  },
  {
    q: "ìƒë¬¼ ë‹¤ì–‘ì„±(ìƒë¬¼ë‹¤ì–‘ì„±)ì´ ë†’ì„ ë•Œ ìƒíƒœê³„ì— ê¸°ëŒ€ë˜ëŠ” ì¥ì ì´ ì•„ë‹Œ ê²ƒì€?",
    opts: ["ì‹œìŠ¤í…œì˜ ì•ˆì •ì„± ì¦ê°€", "ì§ˆë³‘ í™•ì‚° ê°€ëŠ¥ì„± ì¦ê°€", "ìƒì‚°ì„± ë° ë³µì›ë ¥ ì¦ê°€", "ìœ ì „ì  ìì› ë³´ì „ì´ ìš©ì´"],
    a: 1,
    diff: "ë³´í†µ",
    hint: "ë‹¤ì–‘ì„±ì€ ë³´í†µ ë³‘í•´ì¶© ì €í•­ì„±ì— ë„ì›€ì„ ì¤ë‹ˆë‹¤."
  },
  {
    q: "ì˜¨ì‹¤ê°€ìŠ¤ ì¤‘ì—ì„œ ê°€ì¥ ì¸ê°„ í™œë™ìœ¼ë¡œ ì¸í•´ ì¦ê°€í•˜ë©° ì¥ê¸°ì ìœ¼ë¡œ ê¸°í›„ì— í° ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ê°€ìŠ¤ëŠ”?",
    opts: ["ì´ì‚°í™”íƒ„ì†Œ(COâ‚‚)", "ë©”íƒ„(CHâ‚„)", "ì•„ì‚°í™”ì§ˆì†Œ(Nâ‚‚O)", "ì‚°ì†Œ(Oâ‚‚)"],
    a: 0,
    diff: "ë³´í†µ",
    hint: "ê°€ì¥ ë„“ê²Œ ë°°ì¶œë˜ê³  ëˆ„ì ë˜ëŠ” ê¸°ì²´ì…ë‹ˆë‹¤."
  },
  {
    q: "ì§€êµ¬ ìƒíƒœê³„ì—ì„œ 'ì˜ì–‘ë‹¨ê³„(trophic level)' ì „ì´ ì‹œ ì—ë„ˆì§€ ì „ë‹¬ íš¨ìœ¨ì€ ë³´í†µ ì–´ëŠ ì •ë„ë¡œ ì•Œë ¤ì ¸ ìˆë‚˜ìš”?",
    opts: ["ì•½ 1~5%", "ì•½ 10~20%", "ì•½ 50~60%", "ëŒ€ëµ 80% ì´ìƒ"],
    a: 1,
    diff: "ë³´í†µ",
    hint: "ì¼ë°˜ì ìœ¼ë¡œ '10% ë²•ì¹™'ì´ë¼ ë¶€ë¦…ë‹ˆë‹¤."
  },
  { // hard question 1
    q: "ê³ ë‚œì´ë„: í•œ ìˆ²ì˜ íƒ„ì†Œ í¡ìˆ˜ëŸ‰ì„ ì¶”ì •í•  ë•Œ ì‚¬ìš©ë˜ëŠ” ë‹¨ìœ„ì™€ ê°œë…ìœ¼ë¡œ ì˜³ì§€ ì•Šì€ ê²ƒì€?",
    opts: ["íƒ„ì†Œ ë°€ë„ (tC/ha): ë‹¨ìœ„ ë©´ì ë‹¹ ì €ì¥ëœ íƒ„ì†Œ", "íƒ„ì†Œ ìœ ì¶œ(ì„ íƒì ): ì‚¼ë¦¼ ë²Œì±„ë¡œ ì¦‰ì‹œ ëŒ€ê¸°ë¡œ ë°©ì¶œë˜ëŠ” íƒ„ì†ŒëŸ‰", "íƒ„ì†Œ íšŒìˆ˜ìœ¨: ê´‘í•©ì„± ì†ë„ë¡œ 1ë…„ì— í¡ìˆ˜ë˜ëŠ” íƒ„ì†ŒëŸ‰ì„ ì˜ë¯¸", "íƒ„ì†Œ ì†ë°•ë¥ (carbon sequestration rate): ì—°ê°„ ì €ì¥ ì¦ê°€ëŸ‰"],
    a: 2,
    diff: "ê³ ë‚œë„",
    hint: "ê´‘í•©ì„± ì†ë„ ìì²´ëŠ” í¡ìˆ˜ ì†ë„ë¥¼ ë§í•˜ì§€ë§Œ 'íšŒìˆ˜ìœ¨' ìš©ì–´ëŠ” ì¼ë°˜ì ì´ì§€ ì•ŠìŠµë‹ˆë‹¤."
  },
  {
    q: "ë„ì‹œ ì—´ì„¬ í˜„ìƒì„ ì™„í™”í•˜ëŠ” íš¨ê³¼ê°€ í° ë„ì‹œ ì„¤ê³„ ìš”ì†Œë¡œ ì˜³ì§€ ì•Šì€ ê²ƒì€?",
    opts: ["ë…¹ì§€ ë° ë„ì‹œìˆ² í™•ì¥", "ì§€ë¶•Â·ë„ë¡œì˜ ê³ ë°˜ì‚¬(ì €ì•Œë² ë„) í‘œë©´ ì ìš©", "ê³ ì¸µ ë¹Œë”© ë°€ì§‘ìœ¼ë¡œ ê·¸ë¦¼ì ì¦ê°€", "ë„ì‹œ ë‚´ë¶€ì˜ ì—´ ê³µê¸° ë°°ì¶œì„ ë§‰ëŠ” íì‡„í˜• ì„¤ê³„"],
    a: 3,
    diff: "ë³´í†µ",
    hint: "ì—´ì„¬ ì™„í™”ë¥¼ ìœ„í•´ì„œëŠ” í†µí’ê³¼ ë°˜ì‚¬, ë…¹ì§€ê°€ ìœ ë¦¬í•©ë‹ˆë‹¤."
  },
  {
    q: "í•´ì–‘ ì‚°ì„±í™”ì˜ ì£¼ìš” ì›ì¸ê³¼ ê·¸ ê²°ê³¼ë¡œ ì˜ëª» ì—°ê²°ëœ ê²ƒì€?",
    opts: ["ëŒ€ê¸° ì¤‘ COâ‚‚ ì¦ê°€ â†’ í•´ì–‘ì˜ pH ì €í•˜", "pH ì €í•˜ â†’ ì‚°í˜¸ì˜ ì„íšŒí™” ì´‰ì§„", "pH ì €í•˜ â†’ ì¡°ê°œë¥˜ì˜ ê»ë°ê¸° í˜•ì„± ì €í•´", "í•´ì–‘ ìƒíƒœê³„ì˜ ê· í˜• êµë€"],
    a: 1,
    diff: "ë³´í†µ",
    hint: "ì‚°ì„±í™”ëŠ” ì„íšŒí™”ì— ì¥ì• ë¥¼ ì¤ë‹ˆë‹¤."
  },
  {
    q: "ìƒíƒœê³„ ë³µì›ì—ì„œ 'ê¸°ì´ˆì¢…(keystone species)'ì˜ ì—­í• ë¡œ ì˜³ì€ ê²ƒì€?",
    opts: ["ì„œì‹ì§€ì˜ ë¬¼ë¦¬ì  êµ¬ì¡°ë¥¼ ë§Œë“¤ì§€ ëª»í•œë‹¤", "ì „ì²´ ìƒíƒœê³„ êµ¬ì„±ì— ê³¼ë„í•œ ì˜í–¥ì„ ê°€ì§„ë‹¤", "í•­ìƒ ë¨¹ì´ì‚¬ìŠ¬ ìµœìƒìœ„ì— ìœ„ì¹˜í•œë‹¤", "ê°œì²´ ìˆ˜ê°€ ë§ì„ìˆ˜ë¡ í•­ìƒ ê¸°ì´ˆì¢…ì´ë‹¤"],
    a: 1,
    diff: "ë³´í†µ",
    hint: "ê¸°ì´ˆì¢…ì€ ìƒíƒœê³„ ë‚´ì—ì„œ ìƒëŒ€ì ìœ¼ë¡œ ì ì€ ìˆ˜ë¼ë„ í° ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤."
  },
  { // hard question 2
    q: "ê³ ë‚œì´ë„: ë¡œì§€ìŠ¤í‹± ì„±ì¥ ëª¨ë¸ dN/dt = rN(1 - N/K)ì—ì„œ 'K'ì˜ ì˜ë¯¸ë¡œ ì˜³ì§€ ì•Šì€ ì§„ìˆ ì€?",
    opts: ["KëŠ” í™˜ê²½ìˆ˜ìš©ë ¥ì´ë©° ìµœëŒ€ ê°œì²´ìˆ˜ í•œê³„", "Kê°€ ì»¤ì§€ë©´ ì•ˆì •ëœ ê°œì²´ìˆ˜ëŠ” ë” ì»¤ì§„ë‹¤", "KëŠ” ê°œì²´êµ°ì˜ ì„±ì¥ë¥  rê³¼ ë™ì¼í•˜ë‹¤", "í™˜ê²½ ë³€í™”ë¡œ KëŠ” ì‹œê°„ì— ë”°ë¼ ë³€í•  ìˆ˜ ìˆë‹¤"],
    a: 2,
    diff: "ê³ ë‚œë„",
    hint: "rê³¼ KëŠ” ì„œë¡œ ë‹¤ë¥¸ ë§¤ê°œë³€ìˆ˜ì…ë‹ˆë‹¤."
  },
  {
    q: "í”Œë¼ìŠ¤í‹± ì“°ë ˆê¸°ì˜ ìƒíƒœí•™ì  ì˜í–¥ìœ¼ë¡œ ì˜³ì§€ ì•Šì€ ê²ƒì€?",
    opts: ["í•´ì–‘ ìƒë¬¼ì˜ ì„­ì‹ìœ¼ë¡œ ì¸í•œ ë‚´ë¶€ ì¥ê¸° ì†ìƒ", "ë¯¸ì„¸í”Œë¼ìŠ¤í‹±ì´ ë¨¹ì´ì‚¬ìŠ¬ì„ í†µí•´ ì¶•ì ë  ìˆ˜ ìˆìŒ", "í”Œë¼ìŠ¤í‹±ì€ ìƒë¶„í•´ë˜ì–´ ìì—°ì—ì„œ ì™„ì „íˆ ì•ˆì „í•´ì§", "í”Œë¼ìŠ¤í‹±ì´ ì„œì‹ì§€ë¥¼ ë¬¼ë¦¬ì ìœ¼ë¡œ ë³€í™”ì‹œí‚¬ ìˆ˜ ìˆìŒ"],
    a: 2,
    diff: "ë³´í†µ",
    hint: "ëŒ€ë¶€ë¶„ì˜ í•©ì„± í”Œë¼ìŠ¤í‹±ì€ ìì—°ì—ì„œ ì‰½ê²Œ ë¶„í•´ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤."
  }
];

/* App state */
let current = 0;
let score = 0;
let answered = Array(quiz.length).fill(false);

const pagesEl = document.getElementById('pages');
const qcountEl = document.getElementById('qcount');
const diffEl = document.getElementById('difficulty');
const bigScoreEl = document.getElementById('bigScore');

/* Build pages */
function buildPages(){
  quiz.forEach((item, idx) => {
    const page = document.createElement('section');
    page.className = 'page';
    page.setAttribute('role','group');
    page.setAttribute('aria-label',`ë¬¸ì œ ${idx+1}`);
    page.innerHTML = `
      <div class="card" data-index="${idx}">
        <div class="qmeta">
          <div>
            <div class="qnum">Q${idx+1}</div>
            <div class="diff" id="diff-${idx}">${item.diff}</div>
          </div>
          <div class="hint" id="hint-${idx}" aria-hidden="true">${item.hint || ''}</div>
        </div>

        <div class="question" id="question-${idx}">${escapeHtml(item.q)}</div>

        <div class="options" id="options-${idx}" role="list">
          ${item.opts.map((o,i) => `
            <div class="option" role="button" tabindex="0" data-idx="${i}" data-q="${idx}" aria-label="ì„ íƒ ${i+1}">
              <div class="label">${['A','B','C','D'][i]}</div>
              <div class="text">${escapeHtml(o)}</div>
            </div>
          `).join('')}
        </div>

        <div class="controls" aria-hidden="false">
          <div class="left-controls">
            <button class="btn" data-action="prev">ì´ì „</button>
            <button class="btn" data-action="next">ë‹¤ìŒ</button>
            <button class="btn" data-action="reveal">í•´ì„¤</button>
          </div>
          <div style="display:flex;gap:12px;align-items:center;">
            <div class="progress" aria-hidden="true"><i style="width:0%"></i></div>
            <div class="btn primary" data-action="skip">ìŠ¤í‚µ</div>
          </div>
        </div>
      </div>
    `;
    pagesEl.appendChild(page);
  });

  // final page
  const final = document.createElement('section');
  final.className = 'page';
  final.innerHTML = `
    <div class="card final">
      <div class="result" id="finalScore">ìµœì¢… ì ìˆ˜: 0 / ${quiz.length}</div>
      <div class="detail" id="finalDetail">ê²°ê³¼ì™€ í•´ì„¤ì„ í™•ì¸í•˜ê³  ì‹¶ìœ¼ë©´ ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>
      <div style="display:flex;gap:12px;margin-top:12px;">
        <button class="btn primary" id="restart">ë‹¤ì‹œí•˜ê¸°</button>
        <button class="btn" id="review">ë¬¸ì œë³„ í•´ì„¤ ë³´ê¸°</button>
      </div>
    </div>
  `;
  pagesEl.appendChild(final);

  attachHandlers();
  updateUI();
}

function escapeHtml(s){
  return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');
}

/* Interaction */
function attachHandlers(){
  // click options
  pagesEl.addEventListener('click', (e) => {
    const opt = e.target.closest('.option');
    if(opt){
      const q = Number(opt.dataset.q);
      const i = Number(opt.dataset.idx);
      selectOption(q, i);
    }
    const btn = e.target.closest('button');
    if(btn && btn.dataset.action){
      handleAction(btn.dataset.action);
    }
  });

  // keyboard navigation
  window.addEventListener('keydown', (e) => {
    if(e.key === 'ArrowRight') { goto(current+1); e.preventDefault(); }
    if(e.key === 'ArrowLeft') { goto(current-1); e.preventDefault(); }
    if(['1','2','3','4'].includes(e.key)){
      const choice = Number(e.key) - 1;
      selectOption(current, choice);
    }
    if(e.key === 'Enter'){
      goto(current+1);
    }
  });

  // per-page option focus with Enter
  pagesEl.addEventListener('keydown', (e) => {
    if(e.key === 'Enter'){
      const focused = document.activeElement;
      if(focused && focused.classList.contains('option')){
        focused.click();
      }
    }
  });

  // restart/review
  document.addEventListener('click', (e) => {
    if(e.target.id === 'restart') resetQuiz();
    if(e.target.id === 'review') showReview();
  });

  // progress animation: update widths
  requestAnimationFrame(()=> {
    updateProgress();
  });
}

/* Select option */
function selectOption(qIndex, optionIndex){
  if(qIndex < 0 || qIndex >= quiz.length) return;
  const page = pagesEl.children[qIndex];
  if(!page) return;
  // prevent double scoring
  if(answered[qIndex]) return;
  answered[qIndex] = true;

  const correct = quiz[qIndex].a;
  const optionsEl = page.querySelectorAll('.option');
  optionsEl.forEach(el => {
    const idx = Number(el.dataset.idx);
    if(idx === correct) el.classList.add('correct');
    if(idx === optionIndex && idx !== correct) el.classList.add('wrong');
    el.setAttribute('aria-disabled','true');
  });

  // scoring: +1 correct
  if(optionIndex === correct){
    score++;
  }

  updateScoreUI();
  // small visual feedback
  const progressInner = page.querySelector('.progress > i');
  if(progressInner){
    progressInner.style.width = '100%';
  }

  // auto advance after short delay
  setTimeout(() => { goto(current+1); }, 700);
}

/* Actions */
function handleAction(action){
  if(action === 'prev') goto(current-1);
  if(action === 'next') goto(current+1);
  if(action === 'skip'){
    // mark answered but no score
    if(!answered[current] && current < quiz.length){
      answered[current] = true;
      const page = pagesEl.children[current];
      const opts = page.querySelectorAll('.option');
      opts.forEach(o => o.setAttribute('aria-disabled','true'));
      const p = page.querySelector('.progress > i');
      if(p) p.style.width = '100%';
    }
    goto(current+1);
  }
  if(action === 'reveal'){
    const page = pagesEl.children[current];
    const hint = page.querySelector(`#hint-${current}`);
    if(hint){
      hint.style.opacity = 1;
      hint.setAttribute('aria-hidden','false');
      hint.animate([{opacity:0},{opacity:1}],{duration:380});
    }
  }
}

/* goto page index */
function goto(idx){
  if(idx < 0) idx = 0;
  if(idx > quiz.length) idx = quiz.length; // final page index is quiz.length
  current = idx;
  const x = -idx * window.innerWidth;
  pagesEl.style.transform = \`translateX(\${x}px)\`;
  updateUI();
}

/* update UI elements */
function updateUI(){
  qcountEl.textContent = current < quiz.length ? \`ë¬¸ì œ \${current+1} / \${quiz.length}\` : \`ê²°ê³¼\`;
  diffEl.textContent = current < quiz.length ? quiz[current].diff : '-';
  bigScoreEl.textContent = \`ì ìˆ˜: \${score}\`;

  // update aria focus for accessibility
  const page = pagesEl.children[current];
  if(page){
    // focus first option if not answered
    const firstOpt = page.querySelector('.option');
    if(firstOpt) firstOpt.focus();
  }

  // if final screen
  if(current === quiz.length){
    const finalScoreEl = document.getElementById('finalScore');
    finalScoreEl.textContent = \`ìµœì¢… ì ìˆ˜: \${score} / \${quiz.length}\`;
  }

  updateProgress();
}

/* update per-page progress visuals */
function updateProgress(){
  const total = quiz.length;
  for(let i=0;i<total;i++){
    const page = pagesEl.children[i];
    if(!page) continue;
    const p = page.querySelector('.progress > i');
    if(!p) continue;
    p.style.width = answered[i] ? '100%' : '0%';
  }
}

/* update score UI */
function updateScoreUI(){
  bigScoreEl.animate([{transform:'scale(1)'},{transform:'scale(1.06)'},{transform:'scale(1)'}],{duration:360});
  bigScoreEl.textContent = \`ì ìˆ˜: \${score}\`;
}

/* reset */
function resetQuiz(){
  current = 0; score = 0; answered = Array(quiz.length).fill(false);
  // clear option classes
  for(let i=0;i<quiz.length;i++){
    const page = pagesEl.children[i];
    if(!page) continue;
    const opts = page.querySelectorAll('.option');
    opts.forEach(o => { o.classList.remove('correct','wrong'); o.removeAttribute('aria-disabled'); });
    const p = page.querySelector('.progress > i');
    if(p) p.style.width = '0%';
    const hint = page.querySelector(`#hint-${i}`);
    if(hint) { hint.style.opacity = 0; hint.setAttribute('aria-hidden','true'); }
  }
  updateUI();
  goto(0);
}

/* review: show answers + explanations (simple) */
function showReview(){
  // open a modal-like overlay by moving to first page and revealing all correct answers
  for(let i=0;i<quiz.length;i++){
    const page = pagesEl.children[i];
    const opts = page.querySelectorAll('.option');
    const correct = quiz[i].a;
    opts.forEach(o => {
      const idx = Number(o.dataset.idx);
      if(idx === correct) o.classList.add('correct');
      o.setAttribute('aria-disabled','true');
    });
  }
  goto(0);
}

/* init */
buildPages();
goto(0);

/* accessibility: respond to resize to keep transform valid */
window.addEventListener('resize', ()=> {
  const x = -current * window.innerWidth;
  pagesEl.style.transition = 'none';
  pagesEl.style.transform = \`translateX(\${x}px)\`;
  requestAnimationFrame(()=> pagesEl.style.transition = '');
});

</script>
</body>
</html>
